.. _vdev:

Develop version
===============

FORCE-dev
---------

Master release: TBA

* **General changes**

  * GDAL >= 3.0 support:

    Since GDAL >= 3.0, the coordinates from coordinate transformation operations are no longer sorted as X/Y or LON/LAT, but in the typical order of each coordinate system.
    This has caused an incompatibility of FORCE with GDAL >= 3.
    This is fixed now. Still, do not use FORCE < 3.5 with GDAL >= 3. Update FORCE instead.

  * Fixed a small bug that prevented program execution when the parameterfile was too long.

  * FORCE programs will now transition to a Unix-typical usage, where non-mandatory options are specified with -o or --long-option.
    This will happen from time to time in the next releases. 
    The new program force-level1-csd is a prototype for this.

  * Reduced the amount of compiler warnings when compiling with gcc 9.3.0 under Ubuntu 20.40 LTS.
    This is ongoing work. The goal is to get rid of all warnings (they are not critical, though).

* **FORCE LEVEL 1 ARCHIVING SYSTEM**

  * new program force-level1-csd:

    The new force-csd tool (cloud storage download) was kindly contributed by Stefan Ernst.
    This tool goes way beyond the capabilities of the former sensor-specific scripts force-level1-landsat and force-level1-sentinel2.
    It downloads Sentinel-2 AND Landsat data from the Google Cloud Storage.
    You need the gutils python package, and you might need an account on Google's end. 
    This is currently free. After communicating with Google, we expect this to remain free in the future.
    force-csd is very efficient, you can use parallel downloads. 
    You can filter the datapool w.r.t. sensor, date, cloud cover, tier level etc. 
    The area of interest can be specified in a variety of ways, e.g. coordinate string as in force-level1-sentinel2, but a list of WRS-2/MGRS scenes, or vector geometries (e.g. shapefile) are also supported.
    Of course, it also takes care about the file queues needed for Level 2 Processing.

  * deprecated programs: force-level1-landsat and force-level1-sentinel2:

    Due to the superiority of force-level1-csd, force-level1-landsat and force-level1-sentinel2 are now deprecated.
    They will remain in the repo for a while, but will only receive minimal support in the future. 
    Users are encouraged to change their workflow accordingly.

* **FORCE HIGHER LEVEL**

  * in force-higher-level, Level 3 sub-module: 
  
    Included a safety query, which ensures that at least one score should be > 0.
    Setting all scores to 0 resulted in some crashes.
    Thanks to Jonas Ard√∂ to report on this.

  * in force-higher-level, TSA sub-module: 

    A new suite of metrics was implemented: Land Surface Phenology descriptors based on a polar transformation, Polarmetrics it is.
    This is based on the paper by Bjorn-Gustaf J. Brooks: https://www.mdpi.com/1999-4907/11/6/606, but was modified (e.g. to consider interannual shifts in the start of the phenological year) and complemented by many more metrics.
    A couple of new parameters are now necessary, force-parameter has been updated to include these in the skeleton.
    See :ref:`tsa-param-polar`.

  * in force-higher-level, TSA sub-module: 
  
    The domain tag of the bandwise FORCE metadata domain was updated to be interoperable with a 4D data model (see force-stack below).

  * in force-higher-level, TSA sub-module: 

    When folding the time series, the quantile statistics were broken with a memory error.
    This is fixed now. Thanks for Christoph Raab and Benjamin Jakimow for reporting this.

  * in force-higher-level, TSA sub-module, trend and CAT analyses: 

    Added a new band to for computing relative change, i.e. gain/loss relative to initial value: (slope*timesteps)/offset. 
    This makes most sense when the index has a physical meaning like fractional cover. 
    This does not make sense at all when offset is negative! Take care.

  * in force-higher-level, TSA sub-module, trend and CAT analyses: 

    fixed an issue that compromised signifance levels for trends, which were computed on DOY-based phenometrics.

* **FORCE AUX**

  * in force-mosaic:

    force-mosaic now copies all metadata to the generated mosaics.
    For this, the new aux tool force-mdcp is used

  * new program force-mdcp:
  
    This new helper tool copies metadata from one file to another.
    This included the FORCE metadata domains.
    This program is now used by force-mosaic to carry the metadata to the generated mosaics.

  * new program force-stack:

    This new tool stacks files in VRT format.
    This works with physical images (e.g. GeoTiffs), as well as VRT files (as e.g. generated by force-mosaic).
    A variable number of input files can be stacked, wildcards are supported.
    Most basically, this is e.g. useful to look at RGB combinations in QGIS, where RGB visualizations cannot be used when the channels are not in the same file.
    If the number of bands in the input files is different, the images are stacked after another, e.g. file 1 band 1, file 1 band 2, file 2 band 1.
    If the number of bands in the input files is the same, the images are stacked with band interleave, e.g. file 1 band 1, file 2 band 1, file 1 band 2, file 2 band 2.
    The second option implements a 4D data model (think of time series), which is consistent with the QGIS plugins Raster Time Series Manager and Raster Data Plotting (C) Andreas Rabe.
    A tutorial is in development to illustrate the interoperable use between FORCE and said QGIS plugins.

  * in force-magic-parameters:

    The user can now change between "all combinations" or "paired combinations".
    Please refer to the program description:
    https://force-eo.readthedocs.io/en/latest/components/auxilliary/magic-parameters.htm
    